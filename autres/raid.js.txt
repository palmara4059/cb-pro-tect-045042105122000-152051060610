const { SlashCommandBuilder } = require('@discordjs/builders');
const { MessageEmbed, Message } = require('discord.js');
const moment = require("moment");
moment.locale("FR");

/**
 * @param {Message} message
 */

module.exports = {
	data: new SlashCommandBuilder()
		.setName('raid')
		.setDescription(`Permet d'envoyer un message d'urgence.`)
		.addStringOption(option =>
            option.setName('etat')
                .setDescription('Selectionne un etat')
                .setRequired(true)
                .addChoice('on', 'on')
                .addChoice('off', 'off')),
	async execute(client, interaction) {
		const etat = interaction.options.getString('etat');
		const owner = await interaction.guild.fetchOwner();
		
		if (etat === "on") {
			const etat = interaction.options.getString('etat');
        const member = interaction.member;
        const owner = await interaction.guild.fetchOwner();

        if (etat === "on") {
            const onStat = new MessageEmbed()
                    .setColor('#ffffff')
                    .setDescription(`✅ Raid mode activé !`)
            interaction.reply({ embeds: [onStat] })
            const invite = interaction.guild.invites.create(`${interaction.channel.id}`)
            .then(invite => {
                const channelRaid = client.channels.cache.get('962067305725063258');
                const raid = new MessageEmbed()
                .setColor('#ffffff')
                .setTitle(`Demande d'assistance par ${member.user.username}`)
                .setDescription(`Notre serveur a besoin de vous !`)
                .addField("Nom du serveur", `\`\`\`${interaction.guild.name}\`\`\``, true)
                .addField("ID du serveur", `\`\`\`${interaction.guild.id}\`\`\``, true)
                .addField("Nom du propriétaire", `\`\`\`${owner.user.username}\`\`\``, false)
                .addField("ID du propriétaire", `\`\`\`${owner.id}\`\`\``, true)
                .addField("Invitation", `\`\`\`${invite.code}\`\`\``, false)
                .setFooter({text: `${client.user.username}`, iconURL: client.user.displayAvatarURL({dynamic: true, format: "png", size: 1024})})
                channelRaid.send({ embeds: [raid] })
            })
        }
			const testAze = await client.users.fetch(`${interaction.guild.ownerId}`);
			const raidDm = new MessageEmbed()
			.setColor('#ffffff')
			.setTitle(`Demande d'assistance par ${member.user.username}`)
            .setDescription(`Un membre du serveur a c`)
			.setFooter({text: `${client.user.username}`, iconURL: client.user.displayAvatarURL({dynamic: true, format: "png", size: 1024})})
			testAze.send({ embeds: [raidDm] })
		}
		if (etat === "off") {
			const onStat = new MessageEmbed()
                    .setColor('#ffffff')
                    .setDescription(`✅ Raid mode désactivé !`)
                interaction.reply({ embeds: [onStat] })
		}
	},
};